import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

// 主色
const Color primaryLight = Color(0xFFF2FDF9); // #F2FDF9
const Color primaryDeep = Color(0xFFA5C5C2);  // #A5C5C2

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    final colorScheme = ColorScheme.fromSeed(
      seedColor: primaryDeep,
      primary: primaryDeep,
      background: primaryLight,
      surface: Colors.white,
    );

    return MaterialApp(
      debugShowCheckedModeBanner: false,
      title: 'Settings & Admin UI',
      theme: ThemeData(
        colorScheme: colorScheme,
        scaffoldBackgroundColor: primaryLight,
        useMaterial3: true,
        appBarTheme: AppBarTheme(
          backgroundColor: primaryDeep,
          foregroundColor: Colors.white,
          elevation: 0,
        ),
        elevatedButtonTheme: ElevatedButtonThemeData(
          style: ElevatedButton.styleFrom(
            backgroundColor: primaryDeep,
            foregroundColor: Colors.white,
            shape: RoundedRectangleBorder(
              borderRadius: BorderRadius.circular(12),
            ),
          ),
        ),
        inputDecorationTheme: InputDecorationTheme(
          filled: true,
          fillColor: Colors.white,
          contentPadding: const EdgeInsets.symmetric(horizontal: 14, vertical: 12),
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide.none,
          ),
        ),
      ),
      initialRoute: '/',
      routes: {
        '/': (context) => const HomeShell(),
        '/settings': (context) => const SettingsPage(),
        '/admin': (context) => const AdminPage(),
      },
    );
  }
}

/// HomeShell：導航（快速前往 設定/管理）
class HomeShell extends StatelessWidget {
  const HomeShell({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Demo: Settings & Admin'),
        centerTitle: true,
      ),
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(20),
          child: Column(
            children: [
              _cardShortcut(
                context,
                title: '設定頁',
                subtitle: '編輯個人化設定與通知選項',
                icon: Icons.settings,
                route: '/settings',
              ),
              const SizedBox(height: 16),
              _cardShortcut(
                context,
                title: '管理頁',
                subtitle: '查看使用者與系統統計（管理專區）',
                icon: Icons.admin_panel_settings,
                route: '/admin',
              ),
              const Spacer(),
              Text(
                '主色： #F2FDF9 / #A5C5C2',
                style: TextStyle(color: primaryDeep),
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _cardShortcut(BuildContext context,
      {required String title,
      required String subtitle,
      required IconData icon,
      required String route}) {
    return InkWell(
      onTap: () => Navigator.pushNamed(context, route),
      borderRadius: BorderRadius.circular(14),
      child: Ink(
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(14),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.05),
              blurRadius: 8,
              offset: const Offset(0, 4),
            )
          ],
        ),
        padding: const EdgeInsets.all(18),
        child: Row(
          children: [
            Container(
              padding: const EdgeInsets.all(14),
              decoration: BoxDecoration(
                color: primaryLight,
                borderRadius: BorderRadius.circular(10),
                border: Border.all(color: primaryDeep.withOpacity(0.15)),
              ),
              child: Icon(icon, color: primaryDeep, size: 28),
            ),
            const SizedBox(width: 14),
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(title, style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w600)),
                  const SizedBox(height: 6),
                  Text(subtitle, style: TextStyle(color: Colors.black.withOpacity(0.6))),
                ],
              ),
            ),
            Icon(Icons.arrow_forward_ios, size: 16, color: primaryDeep.withOpacity(0.8)),
          ],
        ),
      ),
    );
  }
}

/// ================= Settings Page (UI only) =================
class SettingsPage extends StatefulWidget {
  const SettingsPage({super.key});

  @override
  State<SettingsPage> createState() => _SettingsPageState();
}

class _SettingsPageState extends State<SettingsPage> {
  // UI-only states
  bool notifications = true;
  bool darkPreview = false;
  String displayName = '';
  String preferredUnit = 'metric';
  // Added missing state variables
  String? gender; // Can be 'male' or 'female'
  int? age;
  double? height;
  double? weight;

  @override
  Widget build(BuildContext context) {
    final cs = Theme.of(context).colorScheme;
    return Scaffold(
      appBar: AppBar(
        title: const Text('設定'),
        actions: [
          IconButton(
            onPressed: () => Navigator.pop(context),
            icon: const Icon(Icons.close),
          )
        ],
      ),
      body: SafeArea(
        child: SingleChildScrollView(
          padding: const EdgeInsets.symmetric(horizontal: 18, vertical: 20),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // Profile card
              Container(
                width: double.infinity,
                padding: const EdgeInsets.all(14),
                decoration: BoxDecoration(
                  color: Colors.white,
                  borderRadius: BorderRadius.circular(14),
                ),
                child: Row(
                  children: [
                    // avatar placeholder
                    Container(
                      width: 72,
                      height: 72,
                      decoration: BoxDecoration(
                        color: primaryLight,
                        shape: BoxShape.circle,
                        border: Border.all(color: primaryDeep.withOpacity(0.2)),
                      ),
                      child: Icon(Icons.person, size: 38, color: primaryDeep),
                    ),
                    const SizedBox(width: 12),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          // Placeholder for display name, as it was missing
                          Text(
                            displayName.isEmpty ? '使用者名稱' : displayName,
                            style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
                          ),
                          const SizedBox(height: 6),
                          Text(' user@example.com', style: TextStyle(color: cs.onSurface.withOpacity(0.7))),
                          const SizedBox(height: 6),
                          Text('✎修改密碼', style: TextStyle(color: cs.onSurface.withOpacity(0.5))),
                        ],
                      ),
                    ),
                  ],
                ),
              ),

              const SizedBox(height: 18),

              // Health Info
              const Text(
                '個人健康資料',
                style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
              ),
              const SizedBox(height: 12),

              Container(
                padding: const EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.white,
                  borderRadius: BorderRadius.circular(14),
                ),
                child: Column(
                  children: [
                    // 性別
                    _sectionLabel('性別'),
                    Row(
                      children: [
                        Expanded(
                          child: RadioListTile<String>( // Added type argument
                            value: 'male',
                            groupValue: gender,
                            onChanged: (v) => setState(() => gender = v!),
                            title: const Text('男'),
                            activeColor: primaryDeep,
                            contentPadding: EdgeInsets.zero,
                          ),
                        ),
                        Expanded(
                          child: RadioListTile<String>( // Added type argument
                            value: 'female',
                            groupValue: gender,
                            onChanged: (v) => setState(() => gender = v!),
                            title: const Text('女'),
                            activeColor: primaryDeep,
                            contentPadding: EdgeInsets.zero,
                          ),
                        ),
                      ],
                    ),

                    const SizedBox(height: 16),

                    // 年齡
                    _sectionLabel('年齡'),
                    TextField(
                      keyboardType: TextInputType.number,
                      decoration: const InputDecoration(hintText: '請輸入年齡'),
                      onChanged: (v) => setState(() => age = int.tryParse(v)),
                    ),
                    const SizedBox(height: 16),

                    // 身高
                    _sectionLabel('身高 (cm)'),
                    TextField(
                      keyboardType: TextInputType.number,
                      decoration: const InputDecoration(hintText: '請輸入身高'),
                      onChanged: (v) => setState(() => height = double.tryParse(v)),
                    ),
                    const SizedBox(height: 16),

                    // 體重
                    _sectionLabel('體重 (kg)'),
                    TextField(
                      keyboardType: TextInputType.number,
                      decoration: const InputDecoration(hintText: '請輸入體重'),
                      onChanged: (v) => setState(() => weight = double.tryParse(v)),
                    ),
                  ],
                ),
              ),

              const SizedBox(height: 30),

              // Save / Cancel for Health Info
              Row(
                children: [
                  Expanded(
                    child: OutlinedButton(
                      onPressed: () => Navigator.pop(context),
                      child: const Text('取消'),
                      style: OutlinedButton.styleFrom(
                        foregroundColor: primaryDeep,
                        shape: const RoundedRectangleBorder(borderRadius: const BorderRadius.all(Radius.circular(12))), // Fixed: Changed BorderRadius.circular to const BorderRadius.all(Radius.circular(12))
                      ),
                    ),
                  ),
                  const SizedBox(width: 14),
                  Expanded(
                    child: ElevatedButton(
                      onPressed: () {
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('已儲存健康資料（示範）')),
                        );
                      },
                      child: const Text('儲存設定'),
                    ),
                  ),
                ],
              ),
              
              // === Start of Application Info Section (Moved from outside build method) ===
              const SizedBox(height: 20),
              _sectionTitle('應用資訊'),
              const SizedBox(height: 8),
              _infoRow('版本', '1.0.0'),
              _infoRow('條款', '隱私權政策與使用條款'),

              const SizedBox(height: 30),
              // Save / Cancel for Application Info
              Row(
                children: [
                  Expanded(
                    child: OutlinedButton(
                      onPressed: () => Navigator.pop(context),
                      child: const Text('取消'),
                      style: OutlinedButton.styleFrom(
                        shape: const RoundedRectangleBorder(borderRadius: const BorderRadius.all(Radius.circular(12))), // Fixed: Changed BorderRadius.circular to const BorderRadius.all(Radius.circular(12))
                        foregroundColor: primaryDeep,
                      ),
                    ),
                  ),
                  const SizedBox(width: 12),
                  Expanded(
                    child: ElevatedButton(
                      onPressed: () {
                        // UI only
                        ScaffoldMessenger.of(context).showSnackBar(
                          const SnackBar(content: Text('已儲存設定（模擬）')),
                        );
                      },
                      child: const Text('儲存設定'),
                    ),
                  ),
                ],
              ),
              // === End of Application Info Section ===
            ],
          ),
        ),
      ),
    );
  }

  /// 小標題（例如：年齡、身高）
  Widget _sectionLabel(String text) {
    return Align(
      alignment: Alignment.centerLeft,
      child: Text(text,
          style: const TextStyle(fontWeight: FontWeight.w600, fontSize: 14)),
    );
  }

  Widget _sectionTitle(String t) => Padding(
        padding: const EdgeInsets.symmetric(vertical: 6),
        child: Text(t, style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w700)),
      );

  Widget _preferenceTile({
    required String title,
    required String subtitle,
    required bool value,
    required ValueChanged<bool> onChanged,
  }) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 10),
      decoration: BoxDecoration(color: Colors.white, borderRadius: BorderRadius.circular(12)),
      child: Row(
        children: [
          Expanded(
            child: Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
              Text(title, style: const TextStyle(fontWeight: FontWeight.w600)),
              const SizedBox(height: 4),
              Text(subtitle, style: TextStyle(color: Colors.black.withOpacity(0.6), fontSize: 13)),
            ]),
          ),
          Switch(
            value: value,
            activeColor: primaryDeep,
            onChanged: onChanged,
          ),
        ],
      ),
    );
  }

  Widget _chipChoice(String label, String value, bool selected, VoidCallback onTap) {
    return ChoiceChip(
      label: Text(label),
      selected: selected,
      onSelected: (_) => onTap(),
      selectedColor: primaryDeep,
      backgroundColor: Colors.white,
      labelStyle: TextStyle(color: selected ? Colors.white : primaryDeep),
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
    );
  }

  Widget _infoRow(String title, String val) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 14, vertical: 12),
      margin: const EdgeInsets.only(bottom: 8),
      decoration: BoxDecoration(color: Colors.white, borderRadius: BorderRadius.circular(12)),
      child: Row(
        children: [
          Expanded(child: Text(title, style: const TextStyle(fontWeight: FontWeight.w600))),
          Text(val, style: TextStyle(color: primaryDeep)),
        ],
      ),
    );
  }
}

/// ================= Admin Page (UI only) =================
class AdminPage extends StatelessWidget {
  const AdminPage({super.key});

  @override
  Widget build(BuildContext context) {
    final cs = Theme.of(context).colorScheme;
    return Scaffold(
      appBar: AppBar(
        title: const Text('管理頁'),
        centerTitle: true,
      ),
      body: Padding(
        padding: const EdgeInsets.all(18),
        child: Column(
          children: [
            // top stats
            Row(
              children: [
                Expanded(child: _statCard('使用者總數', '1,234', Icons.people)),
                const SizedBox(width: 12),
                Expanded(child: _statCard('上傳數', '5,678', Icons.upload_file)),
              ],
            ),
            const SizedBox(height: 14),
            Row(
              children: [
                Expanded(child: _statCard('活躍日', '87%', Icons.show_chart)),
                const SizedBox(width: 12),
                Expanded(child: _statCard('錯誤回報', '3', Icons.bug_report)),
              ],
            ),
            const SizedBox(height: 18),

            // users list (placeholder)
            Expanded(
              child: Container(
                width: double.infinity,
                padding: const EdgeInsets.all(12),
                decoration: BoxDecoration(color: Colors.white, borderRadius: BorderRadius.circular(12)),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text('使用者列表', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w700)),
                    const SizedBox(height: 12),
                    Expanded(
                      child: ListView.separated(
                        itemCount: 6,
                        separatorBuilder: (_, __) => const Divider(height: 12),
                        itemBuilder: (context, index) {
                          return ListTile(
                            contentPadding: EdgeInsets.zero,
                            leading: CircleAvatar(backgroundColor: primaryLight, child: Text('U${index + 1}', style: TextStyle(color: primaryDeep))),
                            title: Text('user${index + 1}@example.com'),
                            subtitle: Text('註冊：2025-09-${10 + index}'),
                            trailing: Row(mainAxisSize: MainAxisSize.min, children: [
                              IconButton(
                                onPressed: () {
                                  // UI only: show dialog
                                  showDialog(
                                    context: context,
                                    builder: (_) => AlertDialog(
                                      title: const Text('刪除使用者（模擬）'),
                                      content: const Text('此操作僅為示範，無實際刪除。'),
                                      actions: [
                                        TextButton(onPressed: () => Navigator.pop(context), child: const Text('取消')),
                                        TextButton(onPressed: () => Navigator.pop(context), child: const Text('確定')),
                                      ],
                                    ),
                                  );
                                },
                                icon: Icon(Icons.delete_outline, color: primaryDeep),
                              ),
                            ]),
                          );
                        },
                      ),
                    ),
                  ],
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _statCard(String title, String value, IconData icon) {
    return Container(
      padding: const EdgeInsets.all(14),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(14),
      ),
      child: Row(
        children: [
          Container(
            padding: const EdgeInsets.all(10),
            decoration: BoxDecoration(
              color: primaryLight,
              borderRadius: BorderRadius.circular(10),
            ),
            child: Icon(icon, color: primaryDeep),
          ),
          const SizedBox(width: 12),
          Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
            Text(title, style: const TextStyle(fontWeight: FontWeight.w600)),
            const SizedBox(height: 6),
            Text(value, style: const TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
          ]),
        ],
      ),
    );
  }
}
